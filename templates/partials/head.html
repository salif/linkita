{% import "macros.html" as macros %}
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="generator" content="{{ trans(key='footer_zola', lang=lang) | default(value='Zola')}}" />
{%- if lang == config.default_language %}
  {%- set base_url_prefix = config.base_url %}
{%- else %}
  {%- set base_url_prefix = config.base_url ~ "/" ~ lang %}
{%- endif %}
{%- if page.title %}
  {%- set page_title = page.title %}
  {%- if page.description %}
    {%- set page_description = page.description %}
  {%- endif %}
{%- elif section.title %}
  {%- set page_title = section.title %}
  {%- if section.description %}
    {%- set page_description = section.description %}
  {%- endif %}
{%- elif taxonomy.name %}
  {%- if taxonomy.name == "tags"%}
    {%- set page_title = trans(key="word_tags", lang=lang) | title %}
  {%- elif taxonomy.name == "categories"%}
    {%- set page_title = trans(key="word_categories", lang=lang) | title %}
  {%- else %}
    {%- set page_title = taxonomy.name %}
  {%- endif %}
  {%- if term.name %}
    {%- set page_title = term.name ~ " | " ~ page_title %}
  {%- endif %}
{%- elif current_url %}
  {%- set page_title = config.title %}
  {%- set page_description = config.description %}
{%- else %}
  {%- set page_title = trans(key="error_404", lang=lang) | default(value="404") %}
  <meta name="robots" content="noindex" />
  <link rel="canonical" href="{{ get_url(path=`404.html`) | safe }}" />
{%- endif %}

  <title>{%- if page_title == config.title %}{{ page_title }}{% else
    %}{{ page_title ~ " | " ~ config.title }}{% endif %}</title>
  <meta property="og:title" content="{{ page_title }}" />
{%- if page_description %}
  <meta name="description" content="{{ page_description }}" />
  <meta property="og:description" content="{{ page_description }}" />
{%- endif %}
  <meta property="og:site_name" content="{{ config.title }}" />
{%- if current_url %}
  {%- if page.extra.open_graph.url %}
  <meta property="og:url" content="{{ page.extra.open_graph.url }}" />
  {%- else %}
  <meta property="og:url" content="{{ current_url | safe }}" />
  {%- endif %}
  <link rel="canonical" href="{{ current_url | safe }}" />
  {%- if lang == config.default_language %}
    {%- set set_profile = current_path == "/" %}
  {%- else %}
    {%- set set_profile = current_path == "/" ~ lang ~ "/" %}
  {%- endif %}
{%- endif %}

{%- if page.date %}
  <meta property="og:type" content="article" />
  {%- if page.date %}
  <meta property="article:published_time" content="{{ page.date | date(format='%F') }}" />
  {%- endif %}
  {%- if page.updated %}
  <meta property="article:modified_time" content="{{ page.updated | date(format='%F') }}" />
  {%- endif %}
  {%- if page.expiration_time %}
  <meta property="article:expiration_time" content="{{ page.expiration_time | date(format='%F') }}" />
  {%- endif %}
  {%- if page.authors | length > 0 %}
    {%- for page_author in page.authors %}
  <meta property="article:author:username" content="{{ page_author }}" />
    {%- endfor %}
  <meta name="author" content="{{ page.authors | join(sep=', ') }}" />
  {%- else %}
  <meta name="author" content="{{ config.author | default(value=config.title) }}" />
    {%- if config.extra.profile.open_graph.first_name %}
  <meta property="article:author:first_name" content="{{ config.extra.profile.open_graph.first_name }}" />
    {%- endif %}
    {%- if config.extra.profile.open_graph.last_name %}
  <meta property="article:author:last_name" content="{{ config.extra.profile.open_graph.last_name }}" />
    {%- endif %}
    {%- if config.extra.profile.open_graph.username %}
  <meta property="article:author:username" content="{{ config.extra.profile.open_graph.username }}" />
    {%- endif %}
    {%- if config.extra.profile.open_graph.gender %}
  <meta property="article:author:gender" content="{{ config.extra.profile.open_graph.gender }}" />
    {%- endif %}
  {%- endif %}
  {%- if page.extra.open_graph.content_tier %}
  <meta property="article:content_tier" content="{{ page.extra.open_graph.content_tier }}" />
  {%- endif %}
  {%- if page.extra.open_graph.section %}
  <meta property="article:section" content="{{ page.extra.open_graph.section }}" />
  {%- endif %}
  {%- if page.extra.open_graph.opinion %}
  <meta property="article:opinion" content="{{ page.extra.open_graph.opinion == 'true' }}" />
  {%- endif %}

  {%- if page.extra.open_graph.locations %}
    {%- for og_location in page.extra.open_graph.locations %}
  <meta property="article:location" content="{{ og_location }}" />
    {%- endfor %}
  {%- endif %}

  {%- if page.extra.open_graph.tags %}
    {%- for og_tag in page.extra.open_graph.tags %}
  <meta property="article:tag" content="{{ og_tag }}" />
    {%- endfor %}
  {%- endif %}
{%- elif set_profile %}
  <meta property="og:type" content="profile" />
  {%- if config.extra.profile.open_graph.first_name %}
  <meta property="profile:first_name" content="{{ config.extra.profile.open_graph.first_name }}" />
  {%- endif %}
  {%- if config.extra.profile.open_graph.last_name %}
  <meta property="profile:last_name" content="{{ config.extra.profile.open_graph.last_name }}" />
  {%- endif %}
  {%- if config.extra.profile.open_graph.username %}
  <meta property="profile:username" content="{{ config.extra.profile.open_graph.username }}" />
  {%- endif %}
  {%- if config.extra.profile.open_graph.gender %}
  <meta property="profile:gender" content="{{ config.extra.profile.open_graph.gender }}" />
  {%- endif %}
{%- else %}
  <meta property="og:type" content="website" />
{%- endif %}

{%- if config.extra.locales[lang].locale %}
  <meta property="og:locale" content="{{ config.extra.locales[lang].locale }}" />
{%- endif %}

{%- if page.translations or section.translations %}
  {%- set page_translations = page.translations | default(value=section.translations) %}
  {%- for og_locale_alt in page_translations %}
    {%- if og_locale_alt.lang != lang and config.extra.locales[og_locale_alt.lang].locale %}
  <meta property="og:locale:alternate" content="{{ config.extra.locales[og_locale_alt.lang].locale }}" />
    {%- endif %}
  <link rel="alternate" hreflang="{{ og_locale_alt.lang }}" href="{{ og_locale_alt.permalink | safe }}" />
  {%- endfor %}
{%- endif %}

{%- if paginator.previous %}
  <link rel="prev" href="{{ paginator.previous | safe }}" />
{%- endif %}
{%- if paginator.next %}
  <link rel="next" href="{{ paginator.next | safe }}" />
{%- endif %}

{%- if config.extra.profile.open_graph.fediverse_username and
      config.extra.profile.open_graph.fediverse_server %}
  <meta property="fediverse:creator" content="@{{
    config.extra.profile.open_graph.fediverse_username }}@{{
    config.extra.profile.open_graph.fediverse_server | replace(from='https://', to='') }}" />
  {%- if config.extra.profile.open_graph.fediverse_url %}
  <link rel="me" href="{{ config.extra.profile.open_graph.fediverse_url }}" />
  {%- else %}
  <link rel="me" href="https://{{ config.extra.profile.open_graph.fediverse_server |
      replace(from='https://', to='') }}/@{{ config.extra.profile.open_graph.fediverse_username }}" />
  {%- endif %}
{%- endif %}
{%- if config.extra.profile.open_graph.fb_app_id %}
  <meta property="fb:app_id" content="{{ config.extra.profile.open_graph.fb_app_id }}" />
{%- endif %}
{%- if config.extra.profile.open_graph.fb_admins %}
  {%- for fb_admin in config.extra.profile.open_graph.fb_admins %}
  <meta property="fb:admins" content="{{ fb_admin }}" />
  {%- endfor %}
{%- endif %}

{%- if page.extra.cover.image or config.extra.profile.open_graph.image %}
  {%- if page.extra.cover.image %}
    {%- set og_image_path = page.extra.cover.image %}
    {%- set og_image_alt = page.extra.cover.alt %}
  {%- else %}
    {%- set og_image_path = config.extra.profile.open_graph.image %}
    {%- set og_image_alt = config.extra.profile.open_graph.image_alt |
      default(value=config.extra.profile.name[lang]) %}
  {%- endif %}
  <meta property="og:image" content="{{ get_url(path=og_image_path) }}" />
  <meta property="og:image:alt" content="{{ og_image_alt }}" />
  {%- if page.cover_type or page.cover_width or page.cover_height %}
  <meta property="og:image:type" content="{{ page.cover_type }}" />
  <meta property="og:image:width" content="{{ page.cover_width }}" />
  <meta property="og:image:height" content="{{ page.cover_height }}" />>
  {%- else %}
    {%- set og_image_data = get_image_metadata(path=og_image_path) %}
  <meta property="og:image:type" content="{{ og_image_data.mime | safe }}" />
  <meta property="og:image:width" content="{{ og_image_data.width }}" />
  <meta property="og:image:height" content="{{ og_image_data.height }}" />
  {%- endif %}
{%- endif %}

{%- if page.extra.open_graph.audio %}
  <meta property="og:audio" content="{{ page.extra.open_graph.audio }}" />
  {%- if page.extra.open_graph.audio_type %}
  <meta property="og:audio:type" content="{{ page.extra.open_graph.audio_type }}" />
  {%- endif %}
{%- endif %}

{%- if page.extra.open_graph.video %}
  <meta property="og:video" content="{{ page.extra.open_graph.video }}" />
  {%- if page.extra.open_graph.video_type %}
  <meta property="og:video:type" content="{{ page.extra.open_graph.video_type }}" />
  <meta property="og:video:width" content="{{ page.extra.open_graph.video_width }}" />
  <meta property="og:video:height" content="{{ page.extra.open_graph.video_height }}" />
  {%- endif %}
{%- endif %}

{%- if config.extra.webmanifest %}
  <link rel="manifest" href="{{ get_url(path=config.extra.webmanifest, lang=lang) }}">
{%- endif %}
{%- if config.extra.footer.license_url %}
  <link rel="license" href="{{ config.extra.footer.license_url |
    replace(from=`$BASE_URL`, to=base_url_prefix) | safe }}" />
{%- endif %}
{%- if config.extra.footer.privacy_policy_url %}
  <link rel="privacy-policy" href="{{ config.extra.footer.privacy_policy_url |
    replace(from=`$BASE_URL`, to=base_url_prefix) | safe }}" />
{%- endif %}
{%- if config.extra.footer.terms_of_service_url %}
  <link rel="terms-of-service" href="{{ config.extra.footer.terms_of_service_url |
    replace(from=`$BASE_URL`, to=base_url_prefix) | safe }}" />
{%- endif %}
{%- if config.extra.footer.search_page_url %}
  <link rel="search" href="{{ config.extra.footer.search_page_url |
    replace(from=`$BASE_URL`, to=base_url_prefix) | safe }}" />
{%- endif %}

{%- if config.generate_feeds %}
  {%- for feed_filename in config.feed_filenames %}
    {%- if feed_filename == "atom.xml" %}
  <link rel="alternate" type="application/atom+xml" href="{{
    get_url(path=`atom.xml`, lang=lang) }}" title="{{ config.title }} | Atom Feed" />
    {%- elif feed_filename == "rss.xml" %}
  <link rel="alternate" type="application/rss+xml" href="{{
    get_url(path=`rss.xml`, lang=lang) }}" title="{{ config.title }} | RSS Feed" />
    {%- else %}
  <link rel="alternate" title="{{ config.title }} | {{ feed_filename }}" href="{{
    get_url(path=feed_filename, lang=lang) }}" />
    {%- endif %}
  {%- endfor %}
{%- endif %}

  <meta name="theme-color" data-light="{{
    config.extra.style.header_color | default(value='#e4e4e7') }}" data-dark="{{
    config.extra.style.header_dark_color | default(value='#27272a') }}" content="{{
    config.extra.style.header_color | default(value='#e4e4e7') }}" />

  <!-- CSS & JS -->
  <link rel="preload stylesheet" as="style" href="{{ get_url(path=`main.css`) }}" />
  <style>
    :root {
      --bg: {{ config.extra.style.bg_color | default(value="#f4f4f5") }};
      --bg-dark: {{ config.extra.style.bg_dark_color | default(value="#18181b") }};
      --header: {{ config.extra.style.header_color | default(value="#e4e4e7") }};
      --header-dark: {{ config.extra.style.header_dark_color | default(value="#27272a") }};
    }
    :root {
      color-scheme: light;
    }
    :root.dark {
      color-scheme: dark;
    }
  </style>
  <script src="{{ get_url(path=`header.js`) }}"></script>

  <!-- Dark Icon -->
  <link rel="preload" as="image" href="{{ get_url(path=`icons/theme.svg`) }}" />

{%- if set_profile %}
  {%- if config.extra.profile.avatar_url %}
  <link rel="preload" as="image" href="{{ get_url(path=config.extra.profile.avatar_url) }}" />
  {%- endif %}
  {%- if config.extra.profile.social %}
    {%- for image_social in config.extra.profile.social %}
  <link rel="preload" as="image" href="{{ macros::get_social_icon(icon=image_social.name) }}" />
    {%- endfor %}
  {%- endif %}
{%- endif %}

  <!-- Math -->
  {%- if page.extra.math | default(value=config.extra.math) %}
    {% include "partials/math.html" %}
  {%- endif %}

  <!-- Mermaid -->
  {%- if page.extra.mermaid | default(value=config.extra.mermaid) %}
    {% include "partials/mermaid.html" %}
  {%- endif %}

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" sizes="16x16" href="{{ get_url(path=`favicon.ico`) }}" />
  <link rel="apple-touch-icon" type="image/png" href="{{ get_url(path=`apple-touch-icon.png`) }}" />
  <link rel="icon" type="image/png" href="{{ get_url(path=`android-icon.png`) }}" />

  <!-- Head inject -->
  {% include "injects/head.html" ignore missing %}
</head>
